
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Improving Performance Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.0">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../2-1-on-disk-format/" />
    
    
    <link rel="prev" href="../1-5-healthchecks-and-monitoring/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Working with sequins</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../1-1-basic-concepts/">
            
                <a href="../1-1-basic-concepts/">
            
                    
                    Basic Concepts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../1-2-data-requirements/">
            
                <a href="../1-2-data-requirements/">
            
                    
                    Data Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../1-3-querying-sequins/">
            
                <a href="../1-3-querying-sequins/">
            
                    
                    Querying Sequins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../1-4-running-a-distributed-cluster/">
            
                <a href="../1-4-running-a-distributed-cluster/">
            
                    
                    Running a Distributed Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../1-5-healthchecks-and-monitoring/">
            
                <a href="../1-5-healthchecks-and-monitoring/">
            
                    
                    Healthchecks and Monitoring
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.6" data-path="./">
            
                <a href="./">
            
                    
                    Improving Performance
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Internals</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../2-1-on-disk-format/">
            
                <a href="../2-1-on-disk-format/">
            
                    
                    On-Disk Format
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../2-2-sharding/">
            
                <a href="../2-2-sharding/">
            
                    
                    Sharding
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Appendix</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../x-1-configuration-reference/">
            
                <a href="../x-1-configuration-reference/">
            
                    
                    1. Configuration Reference
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Improving Performance</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="improving-performance">Improving Performance</h1><p>Sequins is written to have sane defaults out of the box, and should have very
good performance at rest. In production at Stripe, on AWS instances with SSDs,
we see a 50th percentile latency of about 500&#xB5;s and a 99th percentile latency of
about 2-3ms, and we&apos;ve run loadtests up to about 20k requests a second. If
you&apos;re getting significantly worse performance than that, <a href="https://github.com/stripe/sequins/issues/new" target="_blank">please let us
know</a>.</p><p>That said, there are a few tweaks available to improve load times and reduce
latency in some specific circumstances.</p><h3 id="pre-shard-your-data">Pre-shard Your Data</h3><p>Sequins uses a <a href="../2-2-sharding/">sharding algorithm</a> in which keys are
bucket into N partitions, where the number of partitions is the number of files
in the dataset. To do this, it uses a hash function based on <code>hashCode</code>
function, chosen because it aligns coincidentally with the way Hadoop buckets
keys into reducers.</p><p>In practice, this means that if your Hadoop job outputting the data has a reduce
step, and <strong>the key is the same as the output key</strong>, then your data is
effectively pre-sharded when it&apos;s written out, and each individual sequins
instance can just download the data it needs, rather scanning everything and
downloading just the keys it wants.</p><p>While this obviously isn&apos;t a hard requirement, it can make loading new data much
faster.</p><h3 id="throttle-loads-to-reduce-the-impact-on-latency">Throttle Loads to Reduce the Impact on Latency</h3><p>If you&apos;re constantly loading new data to a cluster, you may see that adversely
impact latency. On small instances, data loads can thrash the disk or network,
causing requests to drop or get timed out.</p><p>Sequins has a couple configuration settings designed to mitigate this. First,
setting <a href="../x-1-configuration-reference#maxparallelloads">max_parallel_loads</a> to
a low number will effectively queue loads for different databases.</p><p>Second, the <a href="../x-1-configuration-reference#throttleloads">throttle_loads</a>
property lets you significantly slow down every database load, by injecting
sleeps into the process. Used carefully, this can let you amortize the loading
cost over the period until your next write is ready.</p><h3 id="tweak-proxy-timeouts">Tweak Proxy Timeouts</h3><p><a href="../x-1-configuration-reference#proxytimeout">proxy_timeout</a> and
<a href="../x-1-configuration-reference#proxystagetimeout">proxy_stage_timeout</a> let
you tweak the &quot;backup request&quot; strategy for proxied requests in a distributed
cluster.</p><p>The defaults, however, are intentionally set high. If you know that
your p99 is consistently under 10ms, for example, then you can adjust the latter
property down, which should reduce variability in latency significantly.</p>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../1-5-healthchecks-and-monitoring/" class="navigation navigation-prev " aria-label="Previous page: Healthchecks and Monitoring">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../2-1-on-disk-format/" class="navigation navigation-next " aria-label="Next page: On-Disk Format">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Improving Performance","level":"2.6","depth":1,"next":{"title":"On-Disk Format","level":"3.1","depth":1,"path":"2-1-on-disk-format/README.md","ref":"2-1-on-disk-format/README.md","articles":[]},"previous":{"title":"Healthchecks and Monitoring","level":"2.5","depth":1,"path":"1-5-healthchecks-and-monitoring/README.md","ref":"1-5-healthchecks-and-monitoring/README.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["-sharing","github","anchorjs"],"pluginsConfig":{"fontsettings":{"theme":"night","family":"sans","size":2},"github":{"url":"https://github.com/stripe/sequins"},"anchorjs":{"icon":"","class":"fa fa-link anchor-link"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"1-6-improving-performance/README.md","mtime":"2016-10-06T12:38:16.000Z","type":"markdown"},"gitbook":{"version":"3.2.0","time":"2016-10-26T13:33:17.628Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.1/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-anchorjs/anchor-style.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

